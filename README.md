# Тестовое задание в Ришат

Cсылка на задание - https://drive.google.com/file/d/1Q19S4T3V71JEFR_qiq_qdBIerqubgQG1/view?usp=sharing

# Стек

- Python 3.11.1
- Django 5.0.2

# Справка

Работающее приложение можно открыть по этой ссылке - http://84.201.177.249/ (SSL сертификат не добавлял, поэтому http, с доменом такая же история). Debug = True специально, для удобного отлова возможных ошибок :)

**Данные для входа в админку:**

Login - admin
Password - admin
E-mail - admin@gmail.com

Реализованы практические все бонусные задания, за исключением:

1) Динамический Item currency - здесь, как я думаю, необходимо было бы реализоввыть логику от региона или пользователя, чтобы все цены пересчитывались на нужную валюту, но это показалось существенным усложнением задачи.

2) Payment Intent - понял смысл этого объекта (позволяет вносить изменения после создания в отличие от сессии и др.), но для грамотного добавления данных к форме для карты (динамически они в ней не формируются), необходимы лучшие навыки вертски, чем у меня на данный момент (или же больше времени), дабы было сделано сносно.

Немного изменены эндпоинты, описывающиеся в задании. Теперь есть только "buy/" и главная страница вместо "item/1/". Сделано для удобства, так как реализованы модели Order, Tax и Discount.

Так, на сайте есть главная страница, на которой размещены все продукты, у каждого продукта в свою очередь есть кнопка "Buy" и "Add to Order". При нажатии на кнопку Buy сразу же будет создаваться сессия с товаром и перенаправление на checkout. В свою очередь, кнопка "Add to Order" добавляет ID товара в список, который при нажатии любой кнопки "Buy" (в том числе главной - в правом верхнем углу), отправит ID в сессию. За все это фактические отвечает эндпоинт "buy/".

Добавление скидки и налога к продуктам рандомизировано для простоты. 

Для тетирования непосредственно платежа, можно взять какую-нибудь карту из документации, например, эту - 4242 4242 4242 4242.

# Локальный запуск

### 1) Запуск на сервере разработчика Django:

Первоочередно, конечно, необходимо создать и активировать виртуальное окружение, а затем установить зависимости:

Виртуальное окружение:

Windows:

```bash
py -3 -m venv env
```

```bash
. venv/Scripts/activate 
```

macOS/Linux:

```bash
python3 -m venv .venv
```

```bash
source env/bin/activate
```

Зависимости:

```bash
pip install -r requirements.txt
```

Вторым шагам следует осуществить миграции:

Windows: 

```bash
py manage.py makemigrations
```

```bash
py manage.py migrate
```

macOS/Linux:

```bash
python3 manage.py makemigrations
```

```bash
python3 manage.py migrate
```

Сам проект запускается стандартно с помощью команды:

Windows:

```bash
py manage.py runserver
```
Linux/MacOS

```bash
python3 manage.py runserver
```

Также для удобства добавлен набор продуктов для предзаполнения БД, работает с помощью встроенной команды Django:

Windows:

```bash
py manage.py loaddata <название файла>
```
Linux/MacOS

```bash
python3 manage.py loaddata <название файла>
```

Наименования файла - items.json

Для доступа в Django админку необходимо также создать суперпользователя:

Windows:

```bash
py manage.py createsuperuser
```
Linux/MacOS

```bash
python3 manage.py createsuperuser
```

### 2) Запуск на Docker контейнерах:

Для запуска проекта используется 3 контейнера: nginx - обратный прокси-сервер, postgres - база данных PostgreSQL, rishat-stripe-django - Django приложение.
Точно такая же конфигурация развернута и на боевом сервере. 

Чтобы "поднять" контейнеры нужно перейти в директорию с docker-compose файлом и ввести в терминал следующую команду:

```bash
docker compose up -d --build
```

При запуске в контейнерах сборка статики, создание миграций и их применение, добавление продуктов, а также создание суперпользователя автоматизированы.

**Данные для входа в админку:**

Login - admin
Password - admin
E-mail - admin@gmail.com

**P.S. У всех переменных, получаемых иp переменных окружения, есть дефолтные значения, но вот ключи из Stripe придется добавлять свои.**
